#!raku

%*ENV<SP6_DUMP_TASK_CODE> = False;

bash "sudo apk add tree coreutils";

directory "scm";

say "current commit is: {tags()<SCM_SHA>}";

git-scm tags()<SCM_URL>, %(
  to => "scm",
  branch => tags<SCM_BRANCH>
);

my $command = q:to /CODE/;
  tomty \
  --only=open \
  --skip=example,experimental,flap,rejected,noroot,deprecated,flickering,clarify,flaky,slow,notabug \
  --show-failed \
  --color \
  --dump-task
CODE

bash $command, %(
  cwd => "{$*CWD}/scm", 
  description => "r3tests", 
  envvars => %( SP6_DUMP_TASK_CODE => "" ),
);
