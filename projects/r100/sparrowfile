#!raku

use Sparky::JobApi;

bash "raku -V > rakuenv.txt";

Sparky::JobApi.new(:mine).put-file("rakuenv.txt","rakuenv.txt");

my $badge = "![Sparky](https://sparky.sparrowhub.io/badge/{tags()<SPARKY_PROJECT>}?foo=bar)";

"badge.txt".IO.spurt($badge);

Sparky::JobApi.new(:mine).put-file("badge.txt","badge.txt");

my $status = True;

for  config()<list><>.sort -> $m {
  my $s = task-run "tasks/install", %(
    module => $m;
  );
  unless $s<success> {
    $status = False;
    Sparky::JobApi.new(:mine).put-file("log.txt","$m.install.log");
  }
}

die unless $status;
