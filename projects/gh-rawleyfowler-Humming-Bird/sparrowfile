#!raku

use Sparky::JobApi;

%*ENV<SP6_DUMP_TASK_CODE> = False;

bash "raku -V > rakuenv.txt";

Sparky::JobApi.new(:mine).put-file("rakuenv.txt","rakuenv.txt");

bash "sudo dpkg -l | grep ssl > ssl.txt"

Sparky::JobApi.new(:mine).put-file("ssl.txt","ssl.txt");

directory "scm";

git-scm tags()<SCM_URL>, %(
  to => "scm",
  branch => tags<SCM_BRANCH>
);

bash "git show --oneline -s > gitinfo.txt", %(
  cwd => "{$*CWD}/scm"
);

Sparky::JobApi.new(:mine).put-file("scm/gitinfo.txt","gitinfo.txt");

bash "zef install . --force-install", %(
  cwd => "{$*CWD}/scm"
);

bash "zef install App::Prove6 --force-install", %(
  cwd => "{$*CWD}/scm"
);


bash "prove6 -I. t/ it/", %(
  cwd => "{$*CWD}/scm"
);
