#!raku

use Sparky::JobApi;

%*ENV<SP6_DUMP_TASK_CODE> = False;

bash "raku -V > rakuenv.txt";

Sparky::JobApi.new(:mine).put-file("rakuenv.txt","rakuenv.txt");

#zef "https://github.com/melezhik/Sparrow6.git",  %( :force, :notest );

directory "scm";

git-scm tags()<SCM_URL>, %(
  to => "scm",
  branch => tags<SCM_BRANCH>
);

bash "git show --oneline -s > gitinfo.txt", %(
  cwd => "{$*CWD}/scm"
);

Sparky::JobApi.new(:mine).put-file("scm/gitinfo.txt","gitinfo.txt");


if (tags()<pacman_config_url>) {

  bash q:to /BASH/, %( description => "get config by http", cwd => "{$*CWD}/scm", envvars => %( url => tags()<pacman_config_url> ) );
    curl $url -o examples/tasks/enable-minilib/pacman.conf
  BASH

  "scm/examples/tasks/enable-minilib/pacman.conf".IO.spurt(
    tags()<pacman_config>
  );

}

Sparky::JobApi.new(:mine).put-file(
  "scm/examples/tasks/enable-minilib/pacman.conf",
  "pacman.conf",
);

bash q:to /BASH/, %( description => "sandbox", cwd => "{$*CWD}/scm" );
  export SP6_LOG_NO_TIMESTAMPS=1
  tomty --color --all --verbose
BASH

